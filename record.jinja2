{%- macro render_streak(streak, label) -%}
    <h2>{{ label }}</h2>
    <div class="streak-length">{{ streak.length }} days</div>
    <div class="streak-date">{{ streak.start_date }}</div>
{%- endmacro -%}

{%- macro render_record(record) -%}
    <div id="record-{{ record.key.id() }}" class="record weekly">
        <ul class="days">
            <li class="day-name"></li>
            <li class="day-name"><div>M</div></li>
            <li class="day-name"></li>
            <li class="day-name"><div>W</div></li>
            <li class="day-name"></li>
            <li class="day-name"><div>F</div></li>
            <li class="day-name"></li>
            {%- for i in range((record.start_date.isoweekday()) % 7) -%}
            <li class="placeholder"></li>
            {%- endfor -%}
            {%- for d in record.calendar -%}
            <li class="day{% if d[0] %} set{% endif %}">
                <div class="tooltip">{{ d[1]|e }}</div>
            </li>
            {%- endfor -%}
        </ul>
        {% set latest_streak = record.latest_streak %}
        {% if latest_streak %}
        <div class="streak-info">
            {% set longest_streak = record.longest_streak %}
            <div class="streak">
                {{ render_streak(longest_streak, 'Longest Streak') }}
            </div>
            <div class="streak">
                {{ render_streak(latest_streak, 'Latest Streak') }}
            </div>
        </div>
        {% endif %}
        <form name="view" action="javascript:void();">
            <h1>View options:</h1>
            <input type="radio" name="layout" value="plain">
            <label>Plain</label>
            <input type="radio" name="layout" value="weekly" checked>
            <label>Github-like</label>
        </form>
    </div>
{%- endmacro -%}

<!doctype html>
<html>
<head>
    <title>{{ record.name|e }}</title>
    <link rel="stylesheet" type="text/css" href="/css/reset.css">
    <link rel="stylesheet" type="text/css" href="/css/record.css">
</head>
<body>
    <header><a href="/r/">home</a></header>
    <form name="set_name" method="post">
        <label for="name">name</label>
        <input type="text" name="name" value="{{ record.name|e }}">
        <input type="hidden" name="method" value="set_name"></input>
        <input type="submit">
    </form>
    <form name="set_startdate" method="post">
        <label for="date">start date</label>
        <input type="text" name="date" value="{{ record.start_date }}">
        <input type="hidden" name="method" value="set_start"></input>
        <input type="submit">
    </form>
    {{ render_record(record) }}
    <script src="/js/record.js"></script>
</body>
</html>
